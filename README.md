# Анализ статистической мощности. Оценка вероятности обнаружения эффекта методом Монте-Карло.
## Входные данные:
В приложении есть сервис ленты новостей. Команда ML-отдела планируют развернуть новый алгоритм, рекомендующий пользователям интересные посты. 
Основные фичи:
- Алгоритм добавляет пользователям **1-2 просмотра**
- **Вероятность** того, что он сработает, составляет **90%**
- Если у пользователя **меньше 50 просмотров**, то алгоритм **не сработает**
  
Предполагается, что увеличение числа просмотров приведёт к увеличению лайков на пользователя.

Требуется проверить, **возможно ли обнаружить различия в среднем количестве лайков на пользователя во время А/В тестирования нового алгоритма?** 
Другими словами, нужно рассчитать статистическую мощность до проведения эксперимента, чтобы определить вероятность обнаружения истинного эффекта (если он существует) с учетом заданного уровня значимости и размера выборки.  
Чтобы ответить на этот вопрос, проведём **симуляцию Монте-Карло**.

На эксперимент нам выделили неделю. Допустим, что за эту неделю в наш сервис зайдёт столько же пользователей, сколько зашло в период АА-теста. Мы планируем разбивать пользователей на две группы в соотношении 50/50. 
**Размер выборки:** количество пользователей в период с 2024-04-26 по 2024-05-02 в соотношении 50/50  

**H0:** CTR_group_2 = CTR_group_3  
**H1:** CTR_group_2 != CTR_group_3  
**alpha** = 0.05 (уровень значимости)

Для разбиения пользователей на группы использовался алгоритм **хэширования с солью**.

## Задача: проверить корректность системы сплитования
1. Сделать симуляцию, провести 10000 А/А тестов:
    - сформировать подвыборки без повторения в 500 юзеров из 2 и 3 экспериментальной группы
    - провести сравнение этих подвыборок t-testом
2. Построить гистограмму распределения получившихся 10000 p-values
3. Посчитать, какой процент p-values оказался меньше либо равен 0.05
4. Сделать вывод по проведенному А/А тесту, корректно ли работает система сплитования

## Результат:
Распределение p-values получилось близкое к равномерному.  
Значения p-value <= 0.05 встречается менее, чем в 5% случаев (4.27%).  
Это значит, что в процессе проведения экспериментов проблем не возникло.  
Проведенный А/А тест говорит о том, что **система сплитования работает корректно**.
