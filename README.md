# Анализ статистической мощности. Оценка вероятности обнаружения эффекта методом Монте-Карло.
## Входные данные:
В приложении есть сервис ленты новостей. Команда ML-отдела планируют развернуть новый алгоритм, рекомендующий пользователям интересные посты. 
Основные фичи:
- Алгоритм добавляет пользователям **1-2 просмотра**
- **Вероятность** того, что он сработает, составляет **90%**
- Если у пользователя **меньше 50 просмотров**, то алгоритм **не сработает**
  
Предполагается, что увеличение числа просмотров приведёт к увеличению лайков на пользователя.

Требуется проверить, **возможно ли обнаружить различия в среднем количестве лайков на пользователя** во время А/В тестирования нового алгоритма? 
Другими словами, нужно рассчитать статистическую мощность до проведения эксперимента, чтобы определить вероятность обнаружения истинного эффекта (если он существует) с учетом заданного уровня значимости и размера выборки. Чтобы ответить на этот вопрос, проведём **симуляцию Монте-Карло**.

**Период эксперимента:** 1 неделя  
**Уровень значимости alpha** = 0.05  
**Размер выборок:** количество пользователей в период А/А теста с 2024-04-26 по 2024-05-02 в соотношении 50/50  

См. задачу ["Анализ результатов А/А теста. Проверка корректности работы системы сплитования."](https://github.com/tatianavoronkova/AA-Test-Splitting-System-Analysis)

## Задача: рассчитать статистическую мощность 
1. Зафиксировать количество тестов, которые будем проводить, N = 20,000
2. Посчитать размер выборок из расчета (кол-во пользователей в период А/А теста) * 0.5
3. Посчитать вероятности просмотров группы А и В
4. Сымитировать эффект алгоритма на просмотры группы В:  
     *group_B_views + ((1 + np.binomial(n=1, p=0.5, size=размер_выборки)) * np.binomial(n=1, p=0.9, size=размер_выборки) * (group_B_views >= 50))*
5. Посчитать вероятности CTR (click-through-rate) для групп А и В, чтобы использовать это как оценку вероятности лайка
6. Получить выборку лайков из биномиального распределения (просмотры, CTR) для групп А и В
7. Сравнить выборки лайков N раз с использованием t-теста с поправкой Уэлча на неравные дисперсии (equal_var=False) и уровнем значимости 0.05
8. Посчитать мощность

## Результат:
Мощность теста 25.4% - слишком мала, чтобы запускать алгоритм на всех пользователей.

Распределение p-values получилось близкое к равномерному.  
Значения p-value <= 0.05 встречается менее, чем в 5% случаев (4.27%).  
Это значит, что в процессе проведения экспериментов проблем не возникло.  
Проведенный А/А тест говорит о том, что **система сплитования работает корректно**.
